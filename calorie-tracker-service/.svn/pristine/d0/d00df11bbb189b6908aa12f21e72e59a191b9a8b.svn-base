package ca.pragmaticdev.ws.service;

import ca.pragmaticdev.ws.data.DailyIntakeImpl;
import ca.pragmaticdev.ws.data.mapper.DailyIntakeMapper;
import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.springframework.beans.factory.annotation.Autowired;
import javax.ws.rs.core.MediaType;
import javax.ws.rs.core.Response;
import org.springframework.stereotype.Service;
import org.apache.log4j.Logger;
import java.util.List;

@Service
public class DailyIntakeService {

    protected static Logger logger = Logger.getLogger(DailyIntakeService.class);

    @Autowired(required = true)
    private DailyIntakeMapper dailyIntakeMapper;

    public Response getDailyIntakeByUserId(long userId) {

        List<DailyIntakeImpl> dailyIntakeList = dailyIntakeMapper.SelectAll();

        for (DailyIntakeImpl dailyIntake : dailyIntakeList) {

        }

        return s
    }

    private Response convertListToJson(List<DailyIntakeImpl> list) {

        ObjectMapper mapper = new ObjectMapper();
        String json;
        try {
            json = mapper.writeValueAsString(list);
        } catch (JsonProcessingException e) {
            logger.error(e);
            return getServerErrorResponse(e.getStackTrace().toString());
        }

        return getOkResponse(json);
    }

    private Response getServerErrorResponse(String exception) {
        return Response.status(Response.Status.INTERNAL_SERVER_ERROR).entity(exception).build();
    }

    //Reference: http://stackoverflow.com/questions/23450494/how-to-enable-cross-domain-requests-on-jax-rs-web-services
    private Response getOkResponse(String json) {
        return Response.
                ok(json, MediaType.APPLICATION_JSON)
                .header("Access-Control-Allow-Origin", "*")
                .header("Access-Control-Allow-Headers", "origin, content-type, accept, authorization")
                .header("Access-Control-Allow-Credentials", "true")
                .header("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE, OPTIONS, HEAD")
                .header("Access-Control-Max-Age", "1209600")
                .build();
    }

}
